<main class="main">

  <!-- Page Title -->
  <div class="page-title light-background">
    <div class="container d-lg-flex justify-content-between align-items-center">
      <h1 class="mb-2 mb-lg-0">Tra cứu sách</h1>
      <nav class="breadcrumbs">
        <ol>
          <li><a routerLink="/index.html">Trang chủ</a></li>
          <li class="current">Tra cứu sách</li>
        </ol>
      </nav>
    </div>
  </div><!-- End Page Title -->

  <div class="container">
    <div class="row">

      <div class="col-lg-4 sidebar">

        <div class="widgets-container">
          <!-- Brand Filter Widget -->
          <div class="brand-filter-widget widget-item">

            <h3 class="widget-title">Thể loại</h3>

            <div class="brand-filter-content">
              <div class="brand-search">
                <input type="text" class="form-control" placeholder="Tìm kiếm thể loại..." 
                 [(ngModel)]="searchTheLoaiTerm"
                 (input)="filterTheLoais()">
                <!-- <i class="bi bi-search"></i> -->
              </div>
              <!--Code them vao -->
              <div class="brand-list">
                 <!-- Nếu có kết quả -->
                <div *ngIf="filteredTheLoais.length > 0; else noTheLoai">
                  <div *ngFor="let theLoai of filteredTheLoais">
                    <label>
                      <input type="checkbox"
                      [checked]="selectedTheLoaiIds.includes(theLoai.maTl)"
                      (change)="toggleTheLoai(theLoai.maTl, $any($event.target).checked)">
                      {{ theLoai.tenTl }}
                    </label>
                  </div>
                </div>

                  <!-- Nếu không có kết quả -->
                <ng-template #noTheLoai>
                    <p class="text-muted  mt-2">Không tìm thấy thể loại</p>
                </ng-template>
              </div>
              <!--Code them vao -->

              <div class="brand-actions">
                <button class="btn btn-sm btn-outline-primary" (click)="applyTheLoaiFilter()">Áp dụng</button>
                <button class="btn btn-sm btn-outline-success" (click)="selectAllTheLoai()">Chọn tất cả</button>
                <button class="btn btn-sm btn-link" (click)="clearAllTheLoai()">Xóa toàn bộ</button>
              </div>
            </div>

          </div> <!--/Brand Filter Widget-->

        </div>

      </div>

      <div class="col-lg-8">

  <!-- Category Header Section -->
  <section id="category-header" class="category-header section" data-aos="fade-up">
    <!-- Filter and Sort Options -->
    <div class="filter-container mb-4" data-aos-delay="100">
      <div class="row g-3 align-items-center">
        <!-- Search input -->
        <div class="col-12 col-md-8 col-lg-9">
          <div class="filter-item search-form">
            <label for="productSearch" class="form-label text-center d-block fw-bold mb-2">Tra cứu</label>
            <div class="input-group">
              <input type="text" class="form-control" id="productSearch" placeholder="Tìm sách hoặc tác giả..."
                aria-label="Search for books" [formControl]="searchControl" />
              <button class="btn btn-outline-primary search-btn" type="button" (click)="onSearchClick()">
                <i class="bi bi-search"></i>
              </button>
            </div>
            <div *ngIf="error" class="alert alert-danger mt-2">{{ error }}</div>
          </div>
        </div>

        <!-- Sort By -->
        <div class="col-12 col-md-4 col-lg-3">
          <div class="filter-item d-flex flex-column align-items-end">
            <label for="sortBy" class="form-label text-center w-100">Sắp xếp theo</label>
            <select class="form-select w-auto" id="sortBy" [(ngModel)]="sortBy" (change)="onSortChange($event)">
              <option value="asc" selected>Từ A → Z</option>
              <option value="desc">Từ Z → A</option>
              <option value="rating">Đánh giá tốt nhất</option>
              <option value="available">Có thể mượn</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Category Product List Section -->
  <section id="category-product-list" class="category-product-list section" data-aos="fade-up" data-aos-delay="100">
    <div class="row g-4">
      <!-- Loading Spinner -->
      <div *ngIf="loading" class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-2">Đang tải...</p>
      </div>

      <!-- No Results -->
      <div *ngIf="!loading && pagedSaches.length === 0 && searchControl.value?.trim()" class="col-12 text-center py-5">
        <i class="bi bi-book display-4 text-muted"></i>
        <h5 class="mt-3">Không tìm thấy sách phù hợp</h5>
        <p>Hãy thử từ khóa khác!</p>
      </div>

      <!-- Results -->
      <div *ngFor="let sach of pagedSaches" class="col-6 col-xl-4">
        <div class="product-card">
          <div class="product-image">
            <img [src]="getImageUrl(sach.maSach, 'jpg')" class="main-image img-fluid" [alt]="sach.tuaSach" />
            <div class="product-overlay">
              <div class="product-actions">
                <a class="action-btn" [routerLink]="['/book-detail', sach.maSach]" data-bs-toggle="tooltip"
                  title="Xem chi tiết">
                  <i class="bi bi-eye"></i>
                </a>
              </div>
            </div>
          </div>
          <div class="product-details">
            <div class="product-category">{{ sach.tuaSach }}</div>
            <h4 class="product-title">
              <a routerLink="/sach/{{ sach.maSach }}">
                {{ sach.tenTg || 'Không có tác giả' }}
              </a>
            </h4>
            <div class="product-meta">
              <div class="product-price">Số lượng: {{ sach.soLuong }}</div>
              <div class="product-rating">
                <i class="bi bi-star-fill text-warning"></i>
                {{ averageRatings[sach.maSach] || 0 }}
                <span>({{ reviewCounts[sach.maSach] || 0 }})</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Pagination -->
  <section id="category-pagination" class="category-pagination section" *ngIf="totalPages > 1">
    <nav class="d-flex justify-content-center" aria-label="Page navigation">
      <ul>
        <li>
          <a href="#" (click)="prevPage(); $event.preventDefault()" aria-label="Previous page">
            <i class="bi bi-arrow-left"></i>
            <span class="d-none d-sm-inline">Previous</span>
          </a>
        </li>

        <li *ngFor="let p of visiblePages">
          <ng-container *ngIf="p !== '...'; else ellipsis">
            <a href="#" [class.active]="p === currentPage" (click)="onPageClick(p, $event)">
              {{ p }}
            </a>
          </ng-container>
          <ng-template #ellipsis><span class="ellipsis">...</span></ng-template>
        </li>

        <li>
          <a href="#" (click)="nextPage(); $event.preventDefault()" aria-label="Next page">
            <span class="d-none d-sm-inline">Next</span>
            <i class="bi bi-arrow-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </section>

</div>


    </div>
  </div>
</main>