<main class="main">

  <!-- Page Title -->
  <div class="page-title light-background">
    <div class="container d-lg-flex justify-content-between align-items-center">
      <h1 class="mb-2 mb-lg-0">Tra cứu sách</h1>
      <nav class="breadcrumbs">
        <ol>
          <li><a routerLink="/index.html">Trang chủ</a></li>
          <li class="current">Tra cứu sách</li>
        </ol>
      </nav>
    </div>
  </div><!-- End Page Title -->

  <div class="container">
    <div class="row">

      <div class="col-lg-4 sidebar">

        <div class="widgets-container">
          <!-- Brand Filter Widget -->
          <div class="brand-filter-widget widget-item">

            <h3 class="widget-title">Thể loại</h3>

            <div class="brand-filter-content">
              <div class="brand-search">
                <input type="text" class="form-control" placeholder="Tìm kiếm thể loại..." 
                 [(ngModel)]="searchTheLoaiTerm"
                 (input)="filterTheLoais()">
                <!-- <i class="bi bi-search"></i> -->
              </div>
              <!--Code them vao -->
              <div class="brand-list">
                 <!-- Nếu có kết quả -->
                <div *ngIf="filteredTheLoais.length > 0; else noTheLoai">
                  <div *ngFor="let theLoai of filteredTheLoais">
                    <label>
                      <input type="checkbox"
                      [checked]="selectedTheLoaiIds.includes(theLoai.maTl)"
                      (change)="toggleTheLoai(theLoai.maTl, $any($event.target).checked)">
                      {{ theLoai.tenTl }}
                    </label>
                  </div>
                </div>

                  <!-- Nếu không có kết quả -->
                <ng-template #noTheLoai>
                    <p class="text-muted  mt-2">Không tìm thấy thể loại</p>
                </ng-template>
              </div>
              <!--Code them vao -->

              <div class="brand-actions">
                <button class="btn btn-sm btn-outline-primary" (click)="applyTheLoaiFilter()">Áp dụng</button>
                <button class="btn btn-sm btn-outline-success" (click)="selectAllTheLoai()">Chọn tất cả</button>
                <button class="btn btn-sm btn-link" (click)="clearAllTheLoai()">Xóa toàn bộ</button>
              </div>
            </div>

          </div> <!--/Brand Filter Widget-->

        </div>

      </div>

      <div class="col-lg-8">

        <!-- Category Header Section -->
        <section id="category-header" class="category-header section">
          <div class="container" data-aos="fade-up">
            <!-- Filter and Sort Options -->
            <div class="filter-container mb-4" data-aos="fade-up" data-aos-delay="100">
              <div class="row g-3 align-items-center">
                <!-- Search input: approx 70% width on md/lg screens -->
               <div class="col-12 col-md-8 col-lg-9">
                  <div class="filter-item search-form">
                    <label for="productSearch" class="form-label text-center d-block fw-bold mb-2">Tra cứu</label>
                    <div class="input-group">
                      <input type="text" class="form-control" id="productSearch" placeholder="Tìm sách hoặc tác giả..." 
                      aria-label="Search for books" [formControl]="searchControl"/>
                      <button class="btn btn-outline-primary search-btn" type="button" (click)="onSearchClick()" >
                        <i class="bi bi-search"></i>
                      </button>
                    </div>

                    <!-- Hiển thị thông báo lỗi nếu có -->
                    <div *ngIf="error" class="alert alert-danger mt-2">
                        {{ error }}
                    </div>
                  </div>
                </div>


                <!-- Sort By: right aligned -->
                <div class="col-12 col-md-4 col-lg-3">
                  <div class="filter-item d-flex flex-column align-items-end">
                    <label for="sortBy" class="form-label text-center w-100">Sắp xếp theo</label>
                    <select class="form-select w-auto" id="sortBy">
                      <option selected="">Mới nhất</option>
                      <option>Cũ nhất</option>
                      <option>Đánh giá tốt nhất</option>
                      <option>Có thể mượn</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section><!-- /Category Header Section -->

        <!-- Category Product List Section -->
        <section id="category-product-list" class="category-product-list section">
          <div class="container" data-aos="fade-up" data-aos-delay="100">
            <div class="row g-4">
              <!-- Loading Spinner -->
              <div *ngIf="loading" class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Đang tải...</span>
                </div>
                <p class="mt-2">Đang tải...</p>
              </div>

              <!-- No Results (khi không có data và đã search) -->
              <div *ngIf="!loading && pagedSaches.length === 0 && searchControl.value?.trim()" class="col-12 text-center py-5">
                <i class="bi bi-book display-4 text-muted"></i>
                <h5 class="mt-3">Không tìm thấy sách phù hợp</h5>
                <p>Hãy thử từ khóa khác!</p>
              </div>

              <!-- Results List (hiển thị khi có data hoặc load all) -->
              <div *ngFor="let sach of pagedSaches" class="col-6 col-xl-4">
                <div class="product-card">
                  <div class="product-image">
                    <img [src]="getImageUrl(sach.maSach, 'jpg')" class="main-image img-fluid" [alt]="sach.tuaSach">
                    <div class="product-overlay">
                      <div class="product-actions">
                        <button type="button" class="action-btn" data-bs-toggle="tooltip" title="Quick View">
                          <i class="bi bi-eye"></i>
                        </button>
                        <button type="button" class="action-btn" data-bs-toggle="tooltip" title="Add to Cart">
                          <i class="bi bi-cart-plus"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="product-details">
                  <!-- Tên sách -->
                    <div class="product-category">{{ sach.tuaSach }}</div>

                  <!-- Tác giả (thay vì Nhà xuất bản) -->
                    <h4 class="product-title">
                      <a routerLink="/sach/{{ sach.maSach }}">
                        {{ sach.tenTg || 'Không có tác giả' }}
                      </a>
                    </h4>

                  <!-- Thông tin phụ -->
                    <div class="product-meta">
                      <div class="product-price">Số lượng: {{ sach.soLuong }}</div>
                      <div class="product-rating">
                      <i class="bi bi-star-fill"></i>
                        4.8 <span>(42)</span>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </section><!-- /Category Product List Section -->

 <!-- Category Pagination Section (dynamic) -->
<section id="category-pagination" class="category-pagination section">
  <div class="container">
    <nav class="d-flex justify-content-center" aria-label="Page navigation">
      <ul class="pagination">
        <!-- Previous -->
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous">
            <i class="bi bi-arrow-left"></i>
            <span class="d-none d-sm-inline">Previous</span>
          </a>
        </li>

        <!-- Pages -->
        <li *ngFor="let page of [].constructor(totalPages); let i = index" class="page-item" [class.active]="i + 1 === currentPage">
          <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
        </li>

        <!-- Next -->
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next">
            <span class="d-none d-sm-inline">Next</span>
            <i class="bi bi-arrow-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</section>
      </div>
    </div>
  </div>
</main>