<div class="container-fluid">
  <!-- Ti√™u ƒë·ªÅ -->
  <h1 class="h3 mb-4 text-gray-800">Th√¥ng tin t√†i kho·∫£n</h1>

  <div class="row">
    <div class="col-lg-8">

      <!-- üåê Th√¥ng tin t√†i kho·∫£n hi·ªán t·∫°i -->
      <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
          <h6 class="m-0 font-weight-bold text-primary">Chi ti·∫øt t√†i kho·∫£n</h6>
          <div>
            <!-- N√∫t t·∫°o t√†i kho·∫£n m·ªõi -->
            <button
              *ngIf="isAdmin"
              class="btn btn-success btn-sm mr-2"
              (click)="toggleCreateForm()"
            >
              <i class="fas fa-user-plus"></i>
              {{ showCreateForm ? 'ƒê√≥ng form' : 'T·∫°o t√†i kho·∫£n m·ªõi' }}
            </button>

            <!-- N√∫t ƒëƒÉng xu·∫•t -->
            <button class="btn btn-danger btn-sm" (click)="onLogout()">
              <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
            </button>
          </div>
        </div>

        <div class="card-body">
          <!-- FORM TH√îNG TIN T√ÄI KHO·∫¢N -->
          <form (ngSubmit)="onUpdate()" #accountForm="ngForm">
            <!-- T√™n ƒëƒÉng nh·∫≠p -->
            <div class="form-group">
              <label for="acc_username">T√™n ƒëƒÉng nh·∫≠p</label>
              <input type="text" id="acc_username" class="form-control"
                     [(ngModel)]="account.tenDangNhap" name="accTenDangNhap" required readonly />
            </div>

            <!-- H·ªç t√™n -->
            <div class="form-group">
              <label for="acc_fullname">H·ªç v√† t√™n</label>
              <input type="text" id="acc_fullname" class="form-control"
                     [(ngModel)]="account.hoTen" name="accHoTen" />
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="acc_email">Email </label>
              <input
                type="email"
                id="acc_email"
                class="form-control"
                [(ngModel)]="account.email"
                name="accEmail"
                required
                pattern="^[a-zA-Z0-9._%+-]+&#64;gmail\.com$"
                placeholder="vd: example@gmail.com"
                #accEmail="ngModel"
              />
              <div *ngIf="accEmail.invalid && (accEmail.dirty || accEmail.touched)" class="text-danger mt-1">
                <!-- <div *ngIf="accEmail.errors?.['required']">‚ö†Ô∏è Email l√† b·∫Øt bu·ªôc.</div> -->
                <div *ngIf="accEmail.errors?.['pattern']">‚ùå Email ph·∫£i l√† ƒë·ªãa ch·ªâ Gmail h·ª£p l·ªá.</div>
              </div>
            </div>

            <!-- Vai tr√≤ -->
            <div class="form-group">
              <label for="acc_role">Vai tr√≤</label>
              <input type="text" id="acc_role" class="form-control"
                     [(ngModel)]="account.vaiTro" name="accVaiTro" readonly />
            </div>

            <!-- Ch·ª©c v·ª• (n·∫øu l√† nh√¢n vi√™n) -->
            <div class="form-group" *ngIf="account.vaiTro === 'NhanVien'">
              <label for="acc_chucVu">Ch·ª©c v·ª•</label>
              <input type="text" id="acc_chucVu" class="form-control"
                     [(ngModel)]="account.chucVu" name="accChucVu" />
            </div>

            <hr />
            <h6 class="font-weight-bold text-secondary mb-3">ƒê·ªïi m·∫≠t kh·∫©u</h6>

            <!-- M·∫≠t kh·∫©u c≈© -->
            <div class="form-group">
              <label for="acc_oldPassword">M·∫≠t kh·∫©u c≈©</label>
              <input type="password" id="acc_oldPassword" class="form-control"
                     [(ngModel)]="account.matKhauCu" name="accMatKhauCu"
                     placeholder="Nh·∫≠p m·∫≠t kh·∫©u c≈©" />
            </div>

            <!-- M·∫≠t kh·∫©u m·ªõi -->
            <div class="form-group">
              <label for="acc_newPassword">M·∫≠t kh·∫©u m·ªõi</label>
              <input type="password" id="acc_newPassword" class="form-control"
                     [(ngModel)]="account.matKhauMoi" name="accMatKhauMoi"
                     placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (‚â• 8 k√Ω t·ª±)" minlength="8" />
              <small class="form-text text-muted">
                M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±.
              </small>
            </div>

            <!-- C·∫£nh b√°o -->
            <div *ngIf="(account.matKhauCu && !account.matKhauMoi) || (!account.matKhauCu && account.matKhauMoi)"
                 class="text-danger mb-2">
              ‚ùå Ph·∫£i nh·∫≠p c·∫£ m·∫≠t kh·∫©u c≈© v√† m·∫≠t kh·∫©u m·ªõi ƒë·ªÉ ƒë·ªïi m·∫≠t kh·∫©u.
            </div>

            <div *ngIf="account.matKhauMoi && account.matKhauMoi.length < 8"
                 class="text-danger mb-2">
              ‚ùå M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±.
            </div>

            <!-- N√∫t h√†nh ƒë·ªông -->
            <div class="d-flex justify-content-end mt-3">
              <button type="submit" class="btn btn-primary mr-2" [disabled]="accountForm.invalid">
                L∆∞u thay ƒë·ªïi
              </button>
              <button type="button" class="btn btn-danger" (click)="onDeactivate()">
                V√¥ hi·ªáu h√≥a t√†i kho·∫£n
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- üîΩ FORM T·∫†O T√ÄI KHO·∫¢N M·ªöI -->
      <div class="card shadow animate__animated animate__fadeIn" *ngIf="showCreateForm">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <h6 class="m-0 font-weight-bold">T·∫°o t√†i kho·∫£n m·ªõi</h6>
          <button class="btn btn-light btn-sm" (click)="toggleCreateForm()">‚úñ ƒê√≥ng</button>
        </div>

        <div class="card-body">
          <form (ngSubmit)="onCreateAccount()" #createForm="ngForm">
            <!-- Vai tr√≤ -->
            <div class="form-group">
              <label for="new_role">Ch·ªçn vai tr√≤</label>
              <select id="new_role" class="form-control"
                      [(ngModel)]="newAccount.vaiTro" name="newVaiTro" required>
                <option value="">-- Ch·ªçn vai tr√≤ --</option>
                <option value="Admin">Admin</option>
                <option value="NhanVien">Nh√¢n vi√™n</option>
              </select>
            </div>

            <!-- T√™n ƒëƒÉng nh·∫≠p -->
            <div class="form-group">
              <label for="new_username">T√™n ƒëƒÉng nh·∫≠p</label>
              <input type="text" id="new_username" class="form-control"
                     [(ngModel)]="newAccount.tenDangNhap" name="newTenDangNhap" required />
            </div>

            <!-- M·∫≠t kh·∫©u -->
            <div class="form-group">
              <label for="new_password">M·∫≠t kh·∫©u</label>
              <input type="password" id="new_password" class="form-control"
                     [(ngModel)]="newAccount.matKhau" name="newMatKhau"
                     required minlength="8" placeholder="√çt nh·∫•t 8 k√Ω t·ª±" />
            </div>

            <!-- H·ªç t√™n -->
            <div class="form-group">
              <label for="new_hoTen">H·ªç v√† t√™n</label>
              <input type="text" id="new_hoTen" class="form-control"
                     [(ngModel)]="newAccount.hoTen" name="newHoTen" required />
            </div>

            <!-- Ch·ª©c v·ª• -->
            <div class="form-group" *ngIf="newAccount.vaiTro === 'NhanVien'">
              <label for="new_chucVu">Ch·ª©c v·ª•</label>
              <input type="text" id="new_chucVu" class="form-control"
                     [(ngModel)]="newAccount.chucVu" name="newChucVu"
                     placeholder="Nh√¢n vi√™n th∆∞ vi·ªán" />
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="new_email">Email</label>
              <input
                type="email"
                id="new_email"
                class="form-control"
                [(ngModel)]="newAccount.email"
                name="newEmail"
                required
                pattern="^[a-zA-Z0-9._%+-]+&#64;gmail\.com$"
                placeholder="vd: example@gmail.com"
                #newEmail="ngModel"
              />
              <div *ngIf="newEmail.invalid && (newEmail.dirty || newEmail.touched)" class="text-danger mt-1">
                <div *ngIf="newEmail.errors?.['required']">‚ö†Ô∏è Email l√† b·∫Øt bu·ªôc.</div>
                <div *ngIf="newEmail.errors?.['pattern']">
                  ‚ùå Email ph·∫£i l√† ƒë·ªãa ch·ªâ Gmail h·ª£p l·ªá.
                </div>
              </div>
            </div>
            <!-- S·ªë ƒëi·ªán tho·∫°i -->
            <div class="form-group">
              <label for="new_soDT">S·ªë ƒëi·ªán tho·∫°i</label>
              <input
                type="text"
                id="new_soDT"
                class="form-control"
                [(ngModel)]="newAccount.soDT"
                name="newSoDT"
                pattern="^0[0-9]{9}$"
                placeholder="VD: 0909123456"
                #newSoDT="ngModel"
              />
              <div *ngIf="newSoDT.invalid && (newSoDT.dirty || newSoDT.touched)" class="text-danger mt-1">
                ‚ùå S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p 10 ch·ªØ s·ªë b·∫Øt ƒë·∫ßu b·∫±ng 0.
              </div>
            </div>

            <!-- N√∫t h√†nh ƒë·ªông -->
            <div class="d-flex justify-content-end mt-3">
              <button type="button" class="btn btn-secondary mr-2" (click)="toggleCreateForm()">
                H·ªßy
              </button>
              <button type="submit" class="btn btn-success" [disabled]="createForm.invalid">
                T·∫°o t√†i kho·∫£n
              </button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- üîî Toast th√¥ng b√°o n·ªïi -->
<div
  class="toast-container position-fixed top-0 end-0 p-3"
  style="z-index: 2000"
  *ngIf="showToast"
>
  <div
    class="toast align-items-center text-white border-0 show"
    [ngClass]="isSuccess ? 'bg-success' : 'bg-danger'"
    role="alert"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ message }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        (click)="showToast = false"
      ></button>
    </div>
  </div>
</div>
